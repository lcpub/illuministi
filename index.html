<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Come voterebbe un illuminista? ‚Äî Strumento (elettore + profili + radar)</title>

<style>
  :root{
    --bg:#0b1220; --panel:#121b2e; --text:#eaf0ff; --muted:#a9b6d6;
    --ok:#2dd4bf; --bad:#fb7185; --warn:#fbbf24; --line:#2a3552; --ink:#0b1430;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  *{ box-sizing:border-box; }
  body{
    margin:0; font-family:var(--sans);
    background:radial-gradient(1200px 500px at 20% 0%, rgba(45,212,191,0.12), transparent 60%),
               radial-gradient(900px 500px at 90% 10%, rgba(251,113,133,0.10), transparent 60%),
               linear-gradient(180deg,var(--bg),#070b14);
    color:var(--text);
    padding-bottom: 120px;
  }
  header{
    padding:20px 16px;
    border-bottom:1px solid var(--line);
    background: rgba(8,12,22,0.55);
    backdrop-filter: blur(6px);
    position: sticky; top:0; z-index: 10;
  }
  header h1{ margin:0 0 6px 0; font-size:20px; }
  header p{ margin:0; color:var(--muted); max-width:1100px; line-height:1.4; }

  main{
    max-width:1240px;
    margin:0 auto;
    padding:16px;
    display:grid;
    grid-template-columns: 1.05fr 0.95fr;
    gap:16px;
  }
  @media(max-width:980px){ main{ grid-template-columns:1fr; } }

  .card{
    background:rgba(18,27,46,0.92);
    border:1px solid var(--line);
    border-radius:14px;
    padding:14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  }
  .card h2{ margin:0 0 10px 0; font-size:16px; }
  .sub{ color:var(--muted); font-size:13px; line-height:1.4; }
  .hr{ height:1px; background:var(--line); margin:10px 0; }
  .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

  .chip{
    background:rgba(11,20,48,0.55);
    border:1px solid var(--line);
    padding:8px 10px;
    border-radius:999px;
    font-size:13px;
  }
  .chip b{ font-family:var(--mono); font-weight:900; }
  .chip.ok{ border-color: rgba(45,212,191,0.35); }
  .chip.bad{ border-color: rgba(251,113,133,0.35); }
  .chip.warn{ border-color: rgba(251,191,36,0.35); }

  table{
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    overflow:hidden;
    border-radius:12px;
    border:1px solid var(--line);
  }
  th, td{ padding:10px 8px; border-bottom:1px solid var(--line); vertical-align:top; }
  th{ background:#0f1830; font-size:12px; color:var(--muted); text-align:left; }
  tr:last-child td{ border-bottom:none; }
  .code{ font-family:var(--mono); color:#c7d2fe; font-weight:900; }
  .desc{ color:var(--muted); font-size:12px; line-height:1.35; }
  .why{ color:#c7d2fe; font-size:12px; line-height:1.35; margin-top:6px; }

  input[type=number]{
    width:80px; padding:8px;
    background:var(--ink); color:var(--text);
    border:1px solid var(--line); border-radius:10px;
    font-family:var(--mono); font-size:13px;
  }

  button{
    background:#1b2a4d; color:var(--text);
    border:1px solid var(--line);
    border-radius:12px;
    padding:10px 12px;
    cursor:pointer;
    font-weight:900;
  }
  button:hover{ filter:brightness(1.05); }

  canvas{
    background:var(--ink);
    border:1px solid var(--line);
    border-radius:14px;
    width:100%;
    height:430px;
    display:block;
  }

  .kpi{
    display:grid; gap:10px; grid-template-columns:1fr 1fr;
  }
  .kpi .box{
    border:1px solid var(--line);
    border-radius:14px;
    padding:12px;
    background:rgba(11,20,48,0.55);
  }
  .kpi .val{ font-family:var(--mono); font-size:20px; font-weight:900; margin-top:4px; }
  .kpi .lab{ color:var(--muted); font-size:12px; }

  details{
    border:1px solid var(--line);
    border-radius:12px;
    padding:10px 12px;
    background:rgba(11,20,48,0.45);
    margin-top:10px;
  }
  details summary{ cursor:pointer; font-weight:900; }
  details p, details li{ color:var(--muted); font-size:13px; line-height:1.4; }

  /* Profiles */
  .profiles{ display:grid; gap:12px; }
  .profile{
    display:grid; grid-template-columns: 84px 1fr; gap:12px;
    border:1px solid var(--line);
    border-radius:14px;
    padding:12px;
    background:rgba(11,20,48,0.50);
  }
  .profile img{
    width:84px; height:84px;
    object-fit:cover;
    border-radius:14px;
    border:1px solid var(--line);
    background:rgba(255,255,255,0.06);
  }
  .profile h3{ margin:0; font-size:14px; }
  .profile .bio{ margin-top:4px; color:var(--muted); font-size:12px; line-height:1.35; }
  .profile .quote{
    margin-top:8px;
    padding:8px 10px;
    border-left:4px solid rgba(251,191,36,0.9);
    background:rgba(0,0,0,0.18);
    border-radius:10px;
    color:var(--text);
    font-size:12px;
    line-height:1.35;
  }
  .profile .btnrow{ margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; }

  .miniTable{
    margin-top:10px;
    border:1px solid var(--line);
    border-radius:12px;
    overflow:hidden;
  }
  .miniTable table{ border:none; border-radius:0; }
  .miniTable th, .miniTable td{ border-bottom:1px solid var(--line); padding:8px; }
  .miniTable tr:last-child td{ border-bottom:none; }
  .miniTable th{ background:rgba(15,24,48,0.9); }

  /* Sticky disclaimer */
  .disclaimer{
    position:fixed; left:0; right:0; bottom:0;
    border-top:1px solid var(--line);
    background:rgba(8,12,22,0.92);
    backdrop-filter: blur(6px);
    padding:10px 12px;
    z-index:9999;
  }
  .disclaimer .wrap{
    max-width:1240px; margin:0 auto;
    display:flex; gap:10px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
  }
  .disclaimer strong{ color:var(--warn); }
  .disclaimer .text{
    color:var(--muted); font-size:12px; line-height:1.35; max-width:980px;
  }
  .disclaimer button{
    padding:8px 10px; border-radius:999px; font-size:12px; background:#141f3a;
  }
  .sources{
    display:none;
    margin-top:8px;
    padding-top:8px;
    border-top:1px dashed rgba(42,53,82,0.9);
    width:100%;
  }
  .sources a{ color:#c7d2fe; text-decoration:none; }
  .sources a:hover{ text-decoration:underline; }
</style>
</head>

<body>
<header>
  <h1>üó≥Ô∏è Come voterebbe un illuminista? ‚Äî confronto valori (1‚Äì10)</h1>
  <p>
    <b>Cosa fai tu:</b> dai un voto <b>da 1 a 10</b> a ogni criterio (puoi dare lo stesso voto a pi√π criteri).
    <br>
    <b>Cosa fa il sistema:</b> combina i tuoi voti (come importanze) con punteggi S√å/NO e produce un confronto coerente con i tuoi valori.
  </p>
</header>

<main>
  <!-- LEFT: elettore -->
  <section class="card">
    <h2>1) Voti dell‚Äôelettore (1‚Äì10)</h2>
    <div class="sub">
      Non devi ‚Äúdividere 100 punti‚Äù. Basta dare un voto a ciascun criterio.  
      Se due criteri sono ugualmente importanti, dai lo stesso voto.
    </div>

    <div class="row" style="margin-top:10px">
      <span class="chip warn" id="sumChip">Somma dei tuoi voti = <b>‚Äî</b></span>
      <span class="chip ok" id="normChip">Pesi (normalizzati) = <b>1.00</b></span>
      <button id="btnReset">Reset</button>
      <button id="btnAll5">Tutti a 5</button>
    </div>

    <div class="hr"></div>

    <table>
      <thead>
        <tr>
          <th style="width:7%">Cod.</th>
          <th>Criterio</th>
          <th style="width:16%">Il tuo voto (1‚Äì10)</th>
          <th style="width:12%">Peso w</th>
        </tr>
      </thead>
      <tbody id="criteriaBody"></tbody>
    </table>

    <details>
      <summary>Motivazioni ‚Äúscientifiche ma chiare‚Äù dei criteri (perch√© questi 6?)</summary>
      <p>
        Questi criteri sono una traduzione operativa di idee classiche sulla libert√† politica (Montesquieu, Beccaria, Madison)
        e di un metodo moderno per combinare criteri multipli (indicatori compositi / MCDA).
      </p>
      <ul id="motivationList"></ul>
      <p>
        Metodo moderno di riferimento: ‚ÄúHandbook on Constructing Composite Indicators‚Äù (OECD/JRC) su costruzione di indici, pesi e robustezza. [1](https://publications.jrc.ec.europa.eu/repository/handle/JRC47008)[2](https://www.oecd.org/en/publications/handbook-on-constructing-composite-indicators_533411815016.html)[3](https://knowledge4policy.ec.europa.eu/sites/default/files/jrc47008_handbook_final.pdf)
      </p>
    </details>

    <div class="miniTable" style="margin-top:12px">
      <table>
        <thead>
          <tr>
            <th colspan="4">Riepilogo elettore (i tuoi voti) ‚Äî per criterio</th>
          </tr>
          <tr>
            <th>Cod.</th><th>Voto</th><th>Peso w</th><th>Nota</th>
          </tr>
        </thead>
        <tbody id="electorSummary"></tbody>
      </table>
    </div>
  </section>

  <!-- RIGHT: grafico + profili -->
  <aside class="card">
    <h2>2) Grafico + giudizio</h2>

    <div class="kpi">
      <div class="box">
        <div class="lab">Indice S√å (0‚Äì10)</div>
        <div id="siScore" class="val">‚Äî</div>
      </div>
      <div class="box">
        <div class="lab">Indice NO (0‚Äì10)</div>
        <div id="noScore" class="val">‚Äî</div>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <span class="chip" id="winner">Esito: <b>‚Äî</b></span>
      <span class="chip" id="delta">Differenza (S√å‚àíNO): <b>‚Äî</b></span>
    </div>

    <div class="sub" id="whyChoice" style="margin-top:8px">‚Äî</div>

    <div class="hr"></div>

    <canvas id="radar" width="980" height="520"></canvas>
    <div class="sub" style="margin-top:8px">
      <b>Titolo grafico:</b> Punteggi standard S√å/NO per criterio (0‚Äì10).  
      Ogni punto √® etichettato ‚ÄúCk x.y‚Äù.
    </div>

    <div class="hr"></div>

    <h2>3) Profili illuministi (con voti per criterio)</h2>
    <div class="sub">
      Ogni profilo ha un set di voti 1‚Äì10 per i criteri: mostra <b>cosa privilegerebbe</b> secondo i testi.
      Puoi <b>applicarlo</b> (copiare quei voti nei tuoi) oppure solo <b>confrontarlo</b>.
    </div>

    <div class="profiles" id="profiles"></div>
  </aside>
</main>

<div class="disclaimer">
  <div class="wrap">
    <div class="text">
      <strong>Nota:</strong> Il risultato √® una <b>raccomandazione di coerenza</b> (‚Äúdato ci√≤ che ti importa, quale opzione risulta pi√π coerente‚Äù),
      non un obbligo di voto. Le citazioni storiche giustificano i criteri (es. separazione dei poteri, anti‚Äëarbitrio).  
      Fonti e citazioni complete sono indicate nel box ‚Äúriferimenti‚Äù.
    </div>
    <button id="toggleSources">Mostra riferimenti</button>
    <div class="sources" id="sourcesBox">
      <ul>
        <li>Montesquieu, Libro XI: ‚Äúle pouvoir arr√™te le pouvoir‚Äù (Wikisource) ‚Äî <a href="https://fr.wikisource.org/wiki/Esprit_des_lois_%281777%29/L11/C4" target="_blank">link</a>. [4](https://fr.wikisource.org/wiki/Esprit_des_lois_%281777%29/L11/C4)</li>
        <li>Montesquieu, Libro XI cap. VI (libert√† come sicurezza + separazione giudicare) ‚Äî BnF/Gallica ‚Äî <a href="https://gallica.bnf.fr/essentiels/montesquieu/esprit-lois/constitution-angleterre" target="_blank">link</a>. [5](https://gallica.bnf.fr/essentiels/montesquieu/esprit-lois/constitution-angleterre)</li>
        <li>Beccaria, ‚ÄúInterpretazione delle leggi‚Äù (Wikisource) ‚Äî <a href="https://it.wikisource.org/wiki/Dei_delitti_e_delle_pene/Capitolo_IV" target="_blank">link</a>. [6](https://it.wikisource.org/wiki/Dei_delitti_e_delle_pene/Capitolo_IV)</li>
        <li>Madison, Federalist 51 (Constitution Center) ‚Äî <a href="https://constitutioncenter.org/the-constitution/historic-document-library/detail/james-madison-federalist-no-51-1788" target="_blank">link</a>. [7](https://constitutioncenter.org/the-constitution/historic-document-library/detail/james-madison-federalist-no-51-1788)</li>
        <li>OECD/JRC handbook sugli indicatori compositi (metodo) ‚Äî <a href="https://publications.jrc.ec.europa.eu/repository/handle/JRC47008" target="_blank">link</a>. [1](https://publications.jrc.ec.europa.eu/repository/handle/JRC47008)</li>
        <li>Immagini (pubblico dominio): Montesquieu (Commons) <a href="https://commons.wikimedia.org/wiki/File:Montesquieu_1.png" target="_blank">link</a>; Beccaria <a href="https://commons.wikimedia.org/wiki/File:Cesare_Beccaria_1738-1794.jpg" target="_blank">link</a>; Madison <a href="https://commons.wikimedia.org/wiki/File:James_Madison_Portrait2.jpg" target="_blank">link</a>. [8](https://commons.wikimedia.org/wiki/File:Montesquieu_1.png)[9](https://commons.wikimedia.org/wiki/File:Cesare_Beccaria_1738-1794.jpg)[10](https://commons.wikimedia.org/wiki/File:James_Madison_Portrait2.jpg)</li>
      </ul>
    </div>
  </div>
</div>

<script>
/* ===========================
   0) Dati: criteri, motivazioni, citazioni (brevi) e punteggi S√å/NO
   =========================== */

// punteggi S√å/NO qui sono "standard" (0‚Äì10) e servono a creare un confronto replicabile.
// (Puoi modificarli in una versione avanzata, ma qui restiamo nella versione elettore.)

const criteria = [
  {
    code:"C1",
    title:"Separazione del giudicare dalla politica",
    si:6, no:9,
    sci:"Indipendenza istituzionale: ridurre incentivi/leve che permettono a un potere (politico) di influenzarne un altro (giudiziario).",
    quote:"¬´ Il n‚Äôy a point encore de libert√©, si la puissance de juger n‚Äôest pas s√©par√©e‚Ä¶ ¬ª (Livre XI, ch. VI)."
  },
  {
    code:"C2",
    title:"Terziet√†: accusa ‚â† giudice",
    si:9, no:6,
    sci:"Separazione di ruolo/funzione: minimizzare conflitti d‚Äôinteresse e ‚Äúvicinanza strutturale‚Äù tra chi accusa e chi decide.",
    quote:"¬´ Tout serait perdu‚Ä¶ si‚Ä¶ exer√ßaient‚Ä¶ celui de juger‚Ä¶ ¬ª (Livre XI, ch. VI)."
  },
  {
    code:"C3",
    title:"Libert√† come sicurezza (assenza di paura)",
    si:6, no:7,
    sci:"Outcome civico: la libert√† politica come fiducia/sicurezza percepita (assenza di paura di arbitrii) che dipende da istituzioni prevedibili.",
    quote:"¬´ La libert√© politique‚Ä¶ tranquillit√© d‚Äôesprit‚Ä¶ opinion‚Ä¶ de sa s√ªret√©‚Ä¶ ¬ª (Livre XI, ch. VI)."
  },
  {
    code:"C4",
    title:"Leggi chiare, poco arbitrio del giudice",
    si:7, no:7,
    sci:"Predictability: ridurre varianza decisionale e discrezionalit√†; pi√π regole chiare = minore arbitrariet√† e maggiore equit√† di trattamento.",
    quote:"¬´ Nemmeno l‚Äôautorit√† d‚Äôinterpretare le leggi‚Ä¶ pu√≤ risiedere presso i giudici‚Ä¶ ¬ª (Beccaria, cap. IV)."
  },
  {
    code:"C5",
    title:"Resistenza a fazioni e cattura",
    si:7, no:6,
    sci:"Anti-cattura: prevenire monopolio/controllo del sistema da parte di gruppi (interni o esterni) attraverso incentivi e selezione/controlli.",
    quote:"¬´ ‚Ä¶le pouvoir arr√™te le pouvoir. ¬ª (Livre XI, ch. IV)."
  },
  {
    code:"C6",
    title:"Contrappesi robusti nel lungo periodo",
    si:6, no:7,
    sci:"Robustezza dinamica: evitare concentrazione graduale del potere nel tempo; contrappesi e motivazioni interne riducono derive.",
    quote:"‚ÄúAmbition must be made to counteract ambition.‚Äù (Federalist 51)."
  }
];

// citazioni corte sono in pubblico dominio; fonti complete nel box riferimenti. [4](https://fr.wikisource.org/wiki/Esprit_des_lois_%281777%29/L11/C4)[5](https://gallica.bnf.fr/essentiels/montesquieu/esprit-lois/constitution-angleterre)[6](https://it.wikisource.org/wiki/Dei_delitti_e_delle_pene/Capitolo_IV)[7](https://constitutioncenter.org/the-constitution/historic-document-library/detail/james-madison-federalist-no-51-1788)

/* ===========================
   1) Elettore: voti 1‚Äì10 (non 100 punti)
   =========================== */
let electorVotes = [5,5,5,5,5,5]; // default neutro

function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }
function sum(arr){ return arr.reduce((a,b)=>a+b,0); }
function normalizeVotes(votes){
  const s = sum(votes);
  if(s<=0) return votes.map(_=>1/votes.length);
  return votes.map(v=>v/s);
}

function scoreOption(weights, which){ // which: "si"|"no"
  let total = 0;
  for(let i=0;i<criteria.length;i++){
    const perf = (which==="si") ? criteria[i].si : criteria[i].no;
    total += weights[i] * perf;
  }
  return total;
}

/* ===========================
   2) Profili illuministi: voti (1‚Äì10) + bio + citazioni + immagini
   =========================== */

function imgWithFallback(localPath, remoteUrl){
  // prova local, se non esiste browser mostrer√† alt ma poi usiamo fallback via onerror in HTML
  return { local: localPath, remote: remoteUrl };
}

const profileData = {
  montesquieu: {
    name: "Montesquieu",
    years: "1689‚Äì1755",
    icon: "‚öñÔ∏è",
    img: imgWithFallback(
      "img/montesquieu.png",
      "https://upload.wikimedia.org/wikipedia/commons/3/3c/Montesquieu_1.png"
    ), // Wikimedia Commons file page [8](https://commons.wikimedia.org/wiki/File:Montesquieu_1.png)
    bio: "Filosofo politico francese. In De l‚Äôesprit des lois (1748) definisce la libert√† politica come sicurezza e insiste sulla separazione dei poteri, soprattutto sul separare il giudicare dagli altri poteri.",
    coreQuotes: [
      "¬´ Pour qu‚Äôon ne puisse abuser du pouvoir, il faut que, par la disposition des choses, le pouvoir arr√™te le pouvoir. ¬ª (Livre XI, ch. IV).",
      "¬´ Il n‚Äôy a point encore de libert√©, si la puissance de juger n‚Äôest pas s√©par√©e‚Ä¶ ¬ª (Livre XI, ch. VI)."
    ],
    // differenze: pi√π peso a C1,C2,C3,C6 (separazione + sicurezza + contrappesi)
    votes: [9,8,8,4,4,7]
  },
  madison: {
    name: "James Madison",
    years: "1751‚Äì1836",
    icon: "üèõÔ∏è",
    img: imgWithFallback(
      "img/madison.jpg",
      "https://upload.wikimedia.org/wikipedia/commons/7/7d/James_Madison_Portrait2.jpg"
    ), // Wikimedia Commons file page [10](https://commons.wikimedia.org/wiki/File:James_Madison_Portrait2.jpg)
    bio: "Padre fondatore USA. In Federalist 51 (1788) difende checks and balances: la struttura del governo deve creare contrappesi interni per prevenire concentrazioni di potere.",
    coreQuotes: [
      "‚ÄúAmbition must be made to counteract ambition.‚Äù (Federalist 51).",
      "‚ÄúThe great security‚Ä¶ consists in giving‚Ä¶ constitutional means‚Ä¶ to resist encroachments‚Ä¶‚Äù (Federalist 51)."
    ],
    // pi√π peso a C6 e C5, poi C1/C2 medi
    votes: [6,6,6,3,8,10]
  },
  beccaria: {
    name: "Cesare Beccaria",
    years: "1738‚Äì1794",
    icon: "üìú",
    img: imgWithFallback(
      "img/beccaria.jpg",
      "https://upload.wikimedia.org/wikipedia/commons/5/5f/Cesare_Beccaria_1738-1794.jpg"
    ), // Wikimedia Commons file page [9](https://commons.wikimedia.org/wiki/File:Cesare_Beccaria_1738-1794.jpg)
    bio: "Giurista illuminista milanese. In Dei delitti e delle pene (1764) combatte tortura e arbitrariet√† e chiede leggi chiare e giudice vincolato alla legge (anti‚Äëinterpretazione discrezionale).",
    coreQuotes: [
      "¬´ Nemmeno l‚Äôautorit√† d‚Äôinterpretare le leggi penali pu√≤ risedere presso i giudici‚Ä¶ ¬ª (Cap. IV).",
      "¬´ ‚Ä¶il sillogismo perfetto‚Ä¶ la libert√† o la pena‚Ä¶ ¬ª (Cap. IV)."
    ],
    // pi√π peso a C4 e C3 (prevedibilit√† + sicurezza), poi C1/C2 medi
    votes: [6,6,7,10,6,4]
  }
};

/* ===========================
   3) Render UI
   =========================== */
const criteriaBody = document.getElementById("criteriaBody");
const motivationList = document.getElementById("motivationList");
const electorSummary = document.getElementById("electorSummary");

function renderCriteria(){
  criteriaBody.innerHTML = "";
  motivationList.innerHTML = "";

  for(let i=0;i<criteria.length;i++){
    const c = criteria[i];
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="code">${c.code}</td>
      <td>
        <b>${c.title}</b>
        <div class="desc">${c.sci}</div>
        <div class="why"><i>${c.quote}</i></div>
      </td>
      <td>
        <input type="number" min="1" max="10" step="1" value="${electorVotes[i]}" id="v_${i}">
        <div class="desc">1=conta poco ¬∑ 10=conta moltissimo</div>
      </td>
      <td><span class="chip"><b id="w_${i}">‚Äî</b></span></td>
    `;
    criteriaBody.appendChild(tr);

    const li = document.createElement("li");
    li.textContent = `${c.code} ‚Äî ${c.title}: ${c.sci}`;
    motivationList.appendChild(li);
  }

  // listeners
  for(let i=0;i<criteria.length;i++){
    document.getElementById(`v_${i}`).addEventListener("input", (e)=>{
      electorVotes[i] = clamp(Number(e.target.value)||1, 1, 10);
      updateAll();
    });
  }
}

function renderProfiles(){
  const box = document.getElementById("profiles");
  box.innerHTML = "";

  Object.keys(profileData).forEach(key=>{
    const p = profileData[key];
    const card = document.createElement("div");
    card.className = "profile";

    // mini table of votes per criterion
    let miniRows = "";
    for(let i=0;i<criteria.length;i++){
      miniRows += `<tr><td class="code">${criteria[i].code}</td><td>${criteria[i].title}</td><td><b>${p.votes[i]}</b></td></tr>`;
    }

    card.innerHTML = `
      <img src="${p.img.local}" alt="Ritratto di ${p.name}"
           onerror="this.onerror=null; this.src='${p.img.remote}';">
      <div>
        <h3>${p.icon} ${p.name} <span class="desc">(${p.years})</span></h3>
        <div class="bio">${p.bio}</div>
        <div class="quote">${p.coreQuotes.map(q=>`<div>‚Ä¢ ${q}</div>`).join("")}</div>

        <div class="miniTable">
          <table>
            <thead><tr><th colspan="3">Voti del profilo (1‚Äì10) per criterio</th></tr>
            <tr><th style="width:7%">Cod.</th><th>Criterio</th><th style="width:10%">Voto</th></tr></thead>
            <tbody>${miniRows}</tbody>
          </table>
        </div>

        <div class="btnrow">
          <button data-apply="${key}">Applica questi voti ai miei</button>
          <button data-eval="${key}" style="background:#142042">Giudizio del profilo</button>
        </div>

        <div class="desc" id="profileEval_${key}" style="margin-top:10px; display:none;"></div>
      </div>
    `;
    box.appendChild(card);
  });

  // apply buttons
  box.querySelectorAll("button[data-apply]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const key = btn.getAttribute("data-apply");
      electorVotes = [...profileData[key].votes];
      // update inputs
      for(let i=0;i<criteria.length;i++){
        const inp = document.getElementById(`v_${i}`);
        if(inp) inp.value = electorVotes[i];
      }
      updateAll();
      flashToast(`Applicato profilo: ${profileData[key].name}`);
    });
  });

  // profile judgement buttons
  box.querySelectorAll("button[data-eval]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const key = btn.getAttribute("data-eval");
      const el = document.getElementById(`profileEval_${key}`);
      if(!el) return;
      const open = el.style.display === "block";
      if(open){
        el.style.display = "none";
        return;
      }
      el.style.display = "block";
      el.innerHTML = buildProfileJudgementHTML(key);
    });
  });
}

/* ===========================
   4) Sintesi: elettore + profili
   =========================== */

function topCriteriaFromWeights(weights){
  // return indices of top 2 weights
  const pairs = weights.map((w,i)=>({w,i})).sort((a,b)=>b.w-a.w);
  return pairs.slice(0,2).map(p=>p.i);
}

function buildJudgementText(si, no, weights){
  const d = si-no;
  const top2 = topCriteriaFromWeights(weights);
  const a = criteria[top2[0]];
  const b = criteria[top2[1]];

  const baseWhy = `I criteri che pesano di pi√π (secondo i tuoi voti) sono ${a.code} e ${b.code}.`;

  if(Math.abs(d) < 0.0001){
    return {
      label:"pareggio",
      text:`Pareggio: con questi valori, S√å e NO risultano equivalenti. ${baseWhy}`,
      cite:`Principio: la libert√† dipende dalla ‚Äúdisposizione delle cose‚Äù e dai contrappesi.`
    };
  }
  if(d>0){
    return {
      label:"si",
      text:`Consiglio di coerenza: tende a favorire S√å. ${baseWhy} La scelta appare coerente se per te √® centrale la terziet√† nel processo (C2) e/o la riduzione della ‚Äúvicinanza strutturale‚Äù tra accusa e giudice.`,
      cite:`Montesquieu insiste che ‚Äútout serait perdu‚Äù se i poteri si cumulano; separare funzioni √® un cardine. [5](https://gallica.bnf.fr/essentiels/montesquieu/esprit-lois/constitution-angleterre)`
    };
  }
  return {
    label:"no",
    text:`Consiglio di coerenza: tende a favorire NO. ${baseWhy} La scelta appare coerente se per te √® centrale ridurre qualsiasi leva politica sul giudicare (C1) e massimizzare la sicurezza/indipendenza percepita (C3).`,
    cite:`Montesquieu: ‚Äúil n‚Äôy a point encore de libert√©, si la puissance de juger n‚Äôest pas s√©par√©e‚Ä¶‚Äù e libert√† come ‚Äús√ªret√©‚Äù. [5](https://gallica.bnf.fr/essentiels/montesquieu/esprit-lois/constitution-angleterre)`
  };
}

function buildProfileJudgementHTML(key){
  const p = profileData[key];
  const w = normalizeVotes(p.votes);
  const si = scoreOption(w, "si");
  const no = scoreOption(w, "no");
  const d = si-no;
  const top2 = topCriteriaFromWeights(w);

  const topText = top2.map(i=>`${criteria[i].code} (${criteria[i].title})`).join(" + ");
  const rec = d>0 ? "favorisce S√å" : d<0 ? "favorisce NO" : "pareggio";

  // attach one relevant quote depending on dominant criteria
  let quoteSupport = "";
  if(top2.includes(3)){ // C4 beccaria
    quoteSupport = `Richiamo: ${p.coreQuotes[0]} [6](https://it.wikisource.org/wiki/Dei_delitti_e_delle_pene/Capitolo_IV)`;
  } else if(top2.includes(5)){ // C6 madison
    quoteSupport = `Richiamo: ${p.coreQuotes[0]} [7](https://constitutioncenter.org/the-constitution/historic-document-library/detail/james-madison-federalist-no-51-1788)`;
  } else {
    quoteSupport = `Richiamo: ${p.coreQuotes[0]} [4](https://fr.wikisource.org/wiki/Esprit_des_lois_%281777%29/L11/C4)`;
  }

  return `
    <b>Giudizio sintetico (${p.name}):</b> indice S√å=${si.toFixed(2)}, NO=${no.toFixed(2)} ‚áí <b>${rec}</b>.<br>
    <b>Perch√©:</b> questo profilo d√† pi√π peso a <b>${topText}</b> (i suoi valori guida).<br>
    <span class="desc">${quoteSupport}</span>
  `;
}

/* ===========================
   5) Radar chart: sempre visibile, con titolo e label valori
   =========================== */
const radarCanvas = document.getElementById("radar");
const radarCtx = radarCanvas.getContext("2d");

function fitCanvasToCSS(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  const w = Math.max(320, Math.floor(rect.width));
  const h = Math.max(320, Math.floor(rect.height));
  const need = canvas.width !== Math.floor(w*dpr) || canvas.height !== Math.floor(h*dpr);
  if(need){
    canvas.width = Math.floor(w*dpr);
    canvas.height = Math.floor(h*dpr);
  }
  return { w, h, dpr };
}

function drawRadar(){
  const { w, h, dpr } = fitCanvasToCSS(radarCanvas);
  radarCtx.setTransform(dpr,0,0,dpr,0,0);
  radarCtx.clearRect(0,0,w,h);

  const n = criteria.length;
  const labels = criteria.map(c=>c.code);
  const full = criteria.map(c=>`${c.code} ¬∑ ${c.title}`);
  const siVals = criteria.map(c=>clamp(Number(c.si)||0,0,10));
  const noVals = criteria.map(c=>clamp(Number(c.no)||0,0,10));

  // layout
  const cx = w*0.5, cy = h*0.56;
  const R  = Math.min(w,h)*0.33;
  const rot = -Math.PI/2;

  // title
  radarCtx.fillStyle = "rgba(234,240,255,0.95)";
  radarCtx.font = "14px var(--sans)";
  radarCtx.textAlign = "center";
  radarCtx.textBaseline = "top";
  radarCtx.fillText("Radar: punteggi standard S√å/NO per criterio (0‚Äì10)", cx, 10);

  // grid rings
  const gridCol = "rgba(255,255,255,0.10)";
  for(let r=1;r<=5;r++){
    polygon((R*r)/5, gridCol, 1);
  }

  // axes
  const axisCol = "rgba(255,255,255,0.12)";
  for(let i=0;i<n;i++){
    const ang = rot + i*(2*Math.PI/n);
    line(cx,cy,cx+R*Math.cos(ang), cy+R*Math.sin(ang), axisCol, 1);
  }

  // ticks
  radarCtx.fillStyle = "rgba(169,182,214,0.85)";
  radarCtx.font = "12px var(--mono)";
  radarCtx.textBaseline = "middle";
  for(let t=0;t<=10;t+=2){
    const rr = (R*t)/10;
    radarCtx.fillText(String(t), cx, cy-rr);
  }

  // axis labels (wrapped)
  radarCtx.fillStyle = "rgba(234,240,255,0.90)";
  radarCtx.font = "11px var(--sans)";
  for(let i=0;i<n;i++){
    const ang = rot + i*(2*Math.PI/n);
    const ux = Math.cos(ang), uy = Math.sin(ang);
    const x = cx + (R+24)*ux;
    const y = cy + (R+24)*uy;

    radarCtx.textAlign = (ux>0.25)?"left":(ux<-0.25)?"right":"center";
    radarCtx.textBaseline = (uy>0.25)?"top":(uy<-0.25)?"bottom":"middle";
    wrapText(full[i], x, y, 190, 13);
  }

  // datasets
  const siStroke="rgba(45,212,191,0.95)";
  const siFill  ="rgba(45,212,191,0.18)";
  const noStroke="rgba(251,113,133,0.95)";
  const noFill  ="rgba(251,113,133,0.15)";

  drawDataset(noVals, noStroke, noFill);
  drawDataset(siVals, siStroke, siFill);

  // points + point labels
  const noPts = valuesToPts(noVals);
  const siPts = valuesToPts(siVals);
  drawPoints(noPts, noStroke);
  drawPoints(siPts, siStroke);
  drawPointLabels(noPts, noVals, labels, noStroke, -8);
  drawPointLabels(siPts, siVals, labels, siStroke, +8);

  function valuesToPts(values){
    const pts=[];
    for(let i=0;i<n;i++){
      const ang=rot+i*(2*Math.PI/n);
      const rr=R*(values[i]/10);
      pts.push({x:cx+rr*Math.cos(ang), y:cy+rr*Math.sin(ang), ang});
    }
    return pts;
  }
  function polygon(rr, stroke, lw){
    radarCtx.beginPath();
    for(let i=0;i<n;i++){
      const a=rot+i*(2*Math.PI/n);
      const x=cx+rr*Math.cos(a), y=cy+rr*Math.sin(a);
      if(i===0) radarCtx.moveTo(x,y); else radarCtx.lineTo(x,y);
    }
    radarCtx.closePath();
    radarCtx.strokeStyle=stroke; radarCtx.lineWidth=lw; radarCtx.stroke();
  }
  function line(x1,y1,x2,y2,col,lw){
    radarCtx.beginPath();
    radarCtx.moveTo(x1,y1); radarCtx.lineTo(x2,y2);
    radarCtx.strokeStyle=col; radarCtx.lineWidth=lw; radarCtx.stroke();
  }
  function drawDataset(values, stroke, fill){
    const pts=valuesToPts(values);
    radarCtx.beginPath();
    pts.forEach((p,idx)=> idx===0?radarCtx.moveTo(p.x,p.y):radarCtx.lineTo(p.x,p.y));
    radarCtx.closePath();
    radarCtx.fillStyle=fill; radarCtx.fill();
    radarCtx.strokeStyle=stroke; radarCtx.lineWidth=2; radarCtx.stroke();
  }
  function drawPoints(pts, color){
    radarCtx.fillStyle=color;
    pts.forEach(p=>{
      radarCtx.beginPath();
      radarCtx.arc(p.x,p.y,4,0,Math.PI*2);
      radarCtx.fill();
    });
  }
  function drawPointLabels(pts, values, codes, color, perpShift){
    radarCtx.font="11px var(--mono)";
    radarCtx.fillStyle=color;
    for(let i=0;i<pts.length;i++){
      const p=pts[i];
      const ux=Math.cos(p.ang), uy=Math.sin(p.ang);
      const px=-uy, py=ux;
      const out=12;
      const lx=p.x+ux*out+px*perpShift;
      const ly=p.y+uy*out+py*perpShift;

      radarCtx.textAlign=(ux>0.25)?"left":(ux<-0.25)?"right":"center";
      radarCtx.textBaseline=(uy>0.25)?"top":(uy<-0.25)?"bottom":"middle";

      const text=`${codes[i]} ${values[i].toFixed(1)}`;
      strokeText(text,lx,ly,"rgba(11,20,48,0.95)",3);
      radarCtx.fillText(text,lx,ly);
    }
  }
  function wrapText(text, x, y, maxW, lineH){
    const words=String(text).split(" ");
    let line="", lines=[];
    for(let i=0;i<words.length;i++){
      const test = line ? (line + " " + words[i]) : words[i];
      if(radarCtx.measureText(test).width>maxW && line){
        lines.push(line); line=words[i];
      }else{
        line=test;
      }
    }
    if(line) lines.push(line);

    const base=radarCtx.textBaseline;
    if(base==="bottom"){
      for(let i=0;i<lines.length;i++){
        radarCtx.fillText(lines[i], x, y-(lines.length-1-i)*lineH);
      }
    }else{
      for(let i=0;i<lines.length;i++){
        radarCtx.fillText(lines[i], x, y+i*lineH);
      }
    }
  }
  function strokeText(text,x,y,strokeColor,strokeWidth){
    radarCtx.save();
    radarCtx.strokeStyle=strokeColor;
    radarCtx.lineWidth=strokeWidth;
    radarCtx.lineJoin="round";
    radarCtx.strokeText(text,x,y);
    radarCtx.restore();
  }
}

/* ===========================
   6) Update All (elettore + grafico + sintesi + profili)
   =========================== */
function updateAll(){
  const weights = normalizeVotes(electorVotes);

  // update weight display + chips
  document.getElementById("sumChip").innerHTML = `Somma dei tuoi voti = <b>${sum(electorVotes)}</b>`;
  document.getElementById("normChip").innerHTML = `Pesi (normalizzati) = <b>${sum(weights).toFixed(2)}</b>`;

  for(let i=0;i<criteria.length;i++){
    const el = document.getElementById(`w_${i}`);
    if(el) el.textContent = weights[i].toFixed(3);
  }

  // compute scores
  const si = scoreOption(weights,"si");
  const no = scoreOption(weights,"no");
  const d  = si-no;

  document.getElementById("siScore").textContent = si.toFixed(2);
  document.getElementById("noScore").textContent = no.toFixed(2);

  const win = document.getElementById("winner");
  const delta = document.getElementById("delta");
  win.classList.remove("ok","bad");
  delta.classList.remove("ok","bad");
  delta.innerHTML = `Differenza (S√å‚àíNO): <b>${d.toFixed(2)}</b>`;

  const judgement = buildJudgementText(si,no,weights);
  if(judgement.label==="si"){
    win.innerHTML = `Esito: <b>favorisce S√å</b>`;
    win.classList.add("ok"); delta.classList.add("ok");
  }else if(judgement.label==="no"){
    win.innerHTML = `Esito: <b>favorisce NO</b>`;
    win.classList.add("bad"); delta.classList.add("bad");
  }else{
    win.innerHTML = `Esito: <b>pareggio</b>`;
  }

  document.getElementById("whyChoice").innerHTML =
    `<b>Giudizio sintetico (elettore):</b> ${judgement.text}<br><span class="desc">${judgement.cite}</span>`;

  // elector summary table
  electorSummary.innerHTML = "";
  const top2 = topCriteriaFromWeights(weights);
  for(let i=0;i<criteria.length;i++){
    const isTop = top2.includes(i);
    electorSummary.innerHTML += `
      <tr>
        <td class="code">${criteria[i].code}</td>
        <td><b>${electorVotes[i]}</b></td>
        <td>${weights[i].toFixed(3)}</td>
        <td class="desc">${isTop ? "Tra i pi√π influenti nel tuo risultato" : ""}</td>
      </tr>
    `;
  }

  drawRadar();
}

function flashToast(text){
  let t = document.getElementById("toast");
  if(!t){
    t = document.createElement("div");
    t.id="toast";
    t.style.position="fixed";
    t.style.left="50%";
    t.style.transform="translateX(-50%)";
    t.style.bottom="135px";
    t.style.padding="10px 12px";
    t.style.border="1px solid var(--line)";
    t.style.borderRadius="999px";
    t.style.background="rgba(11,20,48,0.92)";
    t.style.color="var(--text)";
    t.style.fontSize="12px";
    t.style.zIndex="9999";
    document.body.appendChild(t);
  }
  t.textContent = text;
  t.style.display="block";
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=>{ t.style.display="none"; }, 1600);
}

/* ===========================
   7) Init + render profiles + controls
   =========================== */
function init(){
  renderCriteria();
  renderProfiles();

  // buttons
  document.getElementById("btnReset").addEventListener("click", ()=>{
    electorVotes = [5,5,5,5,5,5];
    for(let i=0;i<criteria.length;i++){
      document.getElementById(`v_${i}`).value = electorVotes[i];
    }
    updateAll();
    flashToast("Reset: tutti a 5");
  });
  document.getElementById("btnAll5").addEventListener("click", ()=>{
    electorVotes = [5,5,5,5,5,5];
    for(let i=0;i<criteria.length;i++){
      document.getElementById(`v_${i}`).value = electorVotes[i];
    }
    updateAll();
    flashToast("Impostati tutti a 5");
  });

  // references toggle
  document.getElementById("toggleSources").addEventListener("click", ()=>{
    const box = document.getElementById("sourcesBox");
    const open = box.style.display === "block";
    box.style.display = open ? "none" : "block";
    document.getElementById("toggleSources").textContent = open ? "Mostra riferimenti" : "Nascondi riferimenti";
  });

  updateAll();
  window.addEventListener("resize", drawRadar);
}

init();
</script>
</body>
</html>